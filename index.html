<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>بازی دوز</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        font-family: Tahoma, sans-serif;
        background-color: #40E0D0; /* آبی فیروزه‌ای */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
        margin: 0;
        padding: 10px;
        color: #fff;
    }
    h1 { margin: 10px; font-size: 24px; text-align:center; }
    #playerName { margin: 10px; font-size: 16px; text-align:center; }
    #changeNameBtn { margin-left: 5px; cursor: pointer; font-size: 14px; }
    #levelSelection button {
        margin: 5px; padding: 8px 12px; font-size: 14px;
        border: none; border-radius: 5px; cursor: pointer;
    }
    #board {
        display: grid;
        grid-template-columns: repeat(3, 90px);
        grid-template-rows: repeat(3, 90px);
        gap: 4px;
        margin-top: 20px;
    }
    .cell {
        background-color: #008B8B;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        cursor: pointer;
        transition: 0.3s;
    }
    .cell:hover { background-color: #20B2AA; }
    #result { margin-top: 20px; font-size: 18px; text-align:center; }
</style>
</head>
<body>

<h1>بازی دوز</h1>
<div id="playerName">نام شما: <span id="nameDisplay">بازیکن</span> 
<button id="changeNameBtn">تغییر نام</button></div>

<div id="levelSelection">
    <button onclick="setLevel('easy')">آسان</button>
    <button onclick="setLevel('medium')">متوسط</button>
    <button onclick="setLevel('hard')">سخت</button>
    <button onclick="setLevel('ai_unbeatable')">AI بی‌حریف</button>
</div>

<div id="board"></div>
<div id="result"></div>
<p style="margin-top:10px;font-size:12px;text-align:center;">این بازی به درخواست مدیر برنامک ایتا ساخته شده</p>

<audio id="clickSound" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>
<audio id="winSound" src="https://www.soundjay.com/button/sounds/button-10.mp3"></audio>
<audio id="loseSound" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio>

<script>
let board = ["", "", "", "", "", "", "", "", ""];
let player = "X";
let ai = "O";
let level = "easy";
let name = "بازیکن";
let moveHistory = [];

const boardElement = document.getElementById("board");
const resultElement = document.getElementById("result");
const nameDisplay = document.getElementById("nameDisplay");
const clickSound = document.getElementById("clickSound");
const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");

function renderBoard() {
    boardElement.innerHTML = "";
    board.forEach((cell, index) => {
        const div = document.createElement("div");
        div.className = "cell";
        div.textContent = cell;
        div.addEventListener("click", () => playerMove(index));
        boardElement.appendChild(div);
    });
}

function playerMove(index) {
    if (board[index] !== "") return;
    board[index] = player;
    clickSound.play();
    moveHistory.push([...board]);
    renderBoard();
    if (checkWinner(player)) {
        resultElement.textContent = `${name} برد!`;
        winSound.play();
        return;
    }
    if (boardFull()) {
        resultElement.textContent = "مساوی!";
        return;
    }
    setTimeout(aiMove, 500); // کند کردن حرکات AI
}

function aiMove() {
    let move;
    switch(level) {
        case "easy": move = easyMove(); break;
        case "medium": move = mediumMove(); break;
        case "hard": move = hardMove(); break;
        case "ai_unbeatable": move = unbeatableMove(); break;
    }
    board[move] = ai;
    clickSound.play();
    moveHistory.push([...board]);
    renderBoard();
    if (checkWinner(ai)) {
        resultElement.textContent = `AI برد!`;
        loseSound.play();
    } else if (boardFull()) {
        resultElement.textContent = "مساوی!";
    }
}

function easyMove() {
    let empty = board.map((v,i) => v===""?i:null).filter(v=>v!==null);
    return empty[Math.floor(Math.random()*empty.length)];
}

function mediumMove() {
    for(let i=0;i<board.length;i++){if(board[i]==="") return i;}
}

function hardMove() {
    let empty = board.map((v,i)=>v===""?i:null).filter(v=>v!==null);
    for(let i of empty){
        board[i]=ai;
        if(checkWinner(ai)){board[i]=""; return i;}
        board[i]="";
    }
    for(let i of empty){
        board[i]=player;
        if(checkWinner(player)){board[i]=""; return i;}
        board[i]="";
    }
    return empty[Math.floor(Math.random()*empty.length)];
}

function unbeatableMove() {
    let bestScore=-Infinity;
    let move;
    for(let i=0;i<board.length;i++){
        if(board[i]===""){
            board[i]=ai;
            let score=minimax(board,false);
            board[i]="";
            if(score>bestScore){bestScore=score; move=i;}
        }
    }
    return move;
}

function minimax(boardState,isMaximizing){
    if(checkWinner(ai)) return 1;
    if(checkWinner(player)) return -1;
    if(boardState.every(v=>v!=="")) return 0;

    if(isMaximizing){
        let best=-Infinity;
        for(let i=0;i<boardState.length;i++){
            if(boardState[i]===""){
                boardState[i]=ai;
                best=Math.max(best,minimax(boardState,false));
                boardState[i]="";
            }
        }
        return best;
    }else{
        let best=Infinity;
        for(let i=0;i<boardState.length;i++){
            if(boardState[i]===""){
                boardState[i]=player;
                best=Math.min(best,minimax(boardState,true));
                boardState[i]="";
            }
        }
        return best;
    }
}

function checkWinner(p){
    const wins=[
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
    ];
    return wins.some(line=>line.every(i=>board[i]===p));
}

function boardFull(){ return board.every(cell=>cell!==""); }

function setLevel(l){
    level = l;
    board = ["","","","","","","","",""];
    resultElement.textContent="";
    renderBoard();
}

document.getElementById("changeNameBtn").addEventListener("click", ()=>{
    let newName = prompt("اسم خود را وارد کنید:", name);
    if(newName) {name=newName; nameDisplay.textContent=name;}
});

renderBoard();
</script>
</body>
</html>
